.battle-container {
  position: relative;
  display: flex;
  overflow: visible; /* allow glows to extend outside the battle area */
  align-items: flex-start;
  justify-content: space-between;
  width: 100%;
  max-width: 900px;
  box-sizing: border-box;
  margin-top: 2em;
  margin-right: auto;
  margin-left: auto;
}

.player-section {
  overflow: visible; /* allow player glow to extend outside */
  text-align: left;
}

.enemy-section {
  overflow: visible; /* allow enemy glow to extend outside */
  text-align: right;
}

.center-section {
  position: absolute;
  z-index: 2;
  left: 50%;
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: center;
  transform: translateX(-50%);
}

.restart-btn {
  margin: 2em 0;
  border-color: #00ff00;
  color: #00ff00;
}

.restart-btn:hover {
  border-color: #00ffff;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  transform: scale(1.05);
}

.ship-name {
  margin-bottom: 0.5rem;
  font-family: "Courier New", monospace;
  font-size: 1rem;
  font-weight: bold;
}

.player-section .ship-name {
  color: #00ff00;
}

.enemy-section .ship-name {
  color: #ffaa00;
}

.ship-health {
  transition: color 300ms ease;
  font-family: "Courier New", monospace;
  font-size: 1.2rem;
  font-weight: bold;
}

.player-section .ship-health {
  color: #00ff00;
}

.enemy-section .ship-health {
  color: #ffaa00;
}
.ship-emoji {
  position: relative; /* allow engine/trail pseudo-element outside inner */
  display: inline-block;
  overflow: visible; /* allow camo sweep to extend outside the emoji box */
}

.ship-emoji-inner {
  position: relative;
  display: inline-block;
  line-height: 1;
  opacity: 1;
  font-size: 6rem; /* Try 6rem or higher for very large emojis */
  /* start masked (edges transparent) so fade-in can reveal from center */
  -webkit-mask-image: radial-gradient(
    circle at center,
    black 0%,
    black 40%,
    transparent 75%
  );
  mask-image: radial-gradient(
    circle at center,
    black 0%,
    black 40%,
    transparent 75%
  );
  -webkit-mask-position: center center;
  mask-position: center center;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  /* default to visible; the fade-in animation will shrink/grow the mask when used */
  -webkit-mask-size: 200% 200%;
  mask-size: 200% 200%;
  will-change: opacity, filter, transform;
}

.enemy-emoji {
  display: inline-block;
  /* don't flip the parent so pseudo-elements (glow/bloom) keep natural coordinates */
  transform: none;
}

.enemy-wrapper {
  display: inline-block;
  /* flip the entire enemy block so it becomes an exact horizontal mirror of the player */
  transform: scaleX(-1);
  transform-origin: 50% 50%;
}

/* glyph should not be flipped independently when the wrapper flips the whole block */
.enemy-wrapper .ship-emoji-glyph {
  display: inline-block;
  transform: none;
  transform-origin: 50% 50%;
}

/* Star Wars-style explosion, stepped (24fps) â€” bright flash then dissipate */
@keyframes explode-fade {
  0% {
    opacity: 0;
    text-shadow: none;
    transform: scale(0.5);
    filter: brightness(1) blur(0px);
  }
  2% {
    opacity: 1;
    text-shadow: 0 0 18px rgba(255, 220, 120, 0.95);
    transform: scale(1);
    filter: brightness(3) blur(0px);
  }
  6% {
    opacity: 0.9;
    text-shadow: 0 0 14px rgba(255, 200, 90, 0.9);
    transform: scale(1);
    filter: brightness(2.2) blur(1px);
  }
  12% {
    opacity: 0.6;
    text-shadow: 0 0 10px rgba(255, 160, 60, 0.75);
    transform: scale(1);
    filter: brightness(1.6) blur(2px);
  }
  25% {
    opacity: 0.45;
    text-shadow: 0 0 8px rgba(255, 120, 40, 0.6);
    transform: scale(1);
    filter: brightness(1.2) blur(4px);
  }
  50% {
    opacity: 0.25;
    text-shadow: none;
    transform: scale(1);
    filter: brightness(1) blur(6px);
  }
  75% {
    opacity: 0.08;
    transform: scale(1);
    filter: brightness(0.6) blur(10px);
  }
  100% {
    opacity: 0;
    transform: scale(1);
    filter: brightness(0.4) blur(14px);
  }
}

.ship-emoji-inner.explode-fade {
  /* 3s at 24fps = 72 discrete steps for a filmic frame-by-frame feel */
  animation: explode-fade 3000ms steps(72, end) forwards;
  /* make the glow more visible during the flash */
  will-change: opacity, filter, text-shadow;
}

/* Fallback: if parent container is marked exploding, apply same animation to the inner element */
.ship-emoji.exploding .ship-emoji-inner {
  animation: explode-fade 3000ms steps(72, end) forwards;
  will-change: opacity, filter, text-shadow;
}

/* All-direction shake (circular) */
@keyframes ship-shake {
  0% {
    transform: translate(0, 0);
  }
  4% {
    transform: translate(-2px, 2px);
  }
  8% {
    transform: translate(-4px, -2px);
  }
  12% {
    transform: translate(2px, 4px);
  }
  16% {
    transform: translate(4px, -4px);
  }
  20% {
    transform: translate(-4px, 4px);
  }
  24% {
    transform: translate(4px, 2px);
  }
  28% {
    transform: translate(-2px, -4px);
  }
  32% {
    transform: translate(2px, -2px);
  }
  36% {
    transform: translate(-4px, 4px);
  }
  40% {
    transform: translate(4px, -4px);
  }
  44% {
    transform: translate(-4px, 2px);
  }
  48% {
    transform: translate(2px, 4px);
  }
  52% {
    transform: translate(-2px, -4px);
  }
  56% {
    transform: translate(4px, 2px);
  }
  60% {
    transform: translate(-4px, -2px);
  }
  64% {
    transform: translate(2px, 4px);
  }
  68% {
    transform: translate(-2px, -4px);
  }
  72% {
    transform: translate(4px, 2px);
  }
  76% {
    transform: translate(-4px, 4px);
  }
  80% {
    transform: translate(2px, -2px);
  }
  84% {
    transform: translate(-4px, 2px);
  }
  88% {
    transform: translate(4px, -4px);
  }
  92% {
    transform: translate(-2px, 4px);
  }
  96% {
    transform: translate(2px, -4px);
  }
  100% {
    transform: translate(0, 0);
  }
}

.ship-emoji-inner.shake:not(.explode-fade) {
  /* ensure shake wins over non-explosion animations (fade-in, flicker) */
  animation: ship-shake 300ms steps(24, end) both !important;
}

/* Fade-in for respawn (placeholder removed; defined later) */

.ship-emoji-inner.fade-in {
  /* main reveal + subtle flicker */
  animation:
    ship-fade-in 600ms cubic-bezier(0.2, 0.7, 0.4, 1) both,
    ship-flicker 200ms steps(3, end) both;
}

/* camo sweep overlay that reveals from the ship center outward; blur remains strong */
/* camo sweep overlay moved to parent so it is not clipped/masked by the inner emoji */
.ship-emoji.fade-in::before,
.enemy-emoji.fade-in::before {
  position: absolute;
  z-index: 3;
  top: 50%;
  bottom: auto;
  left: 50%;
  width: 120%;
  height: 120%;
  border-radius: 50%;
  opacity: 1;
  background: radial-gradient(
    circle at 50% 8%,
    rgba(255, 255, 220, 1) 0%,
    rgba(255, 220, 120, 1) 12%,
    rgba(255, 160, 60, 0.98) 28%,
    rgba(255, 110, 40, 0.6) 48%,
    rgba(255, 90, 20, 0) 72%
  );
  content: "";
  transform: translate(-50%, -50%) rotate(0deg);
  transform-origin: 50% 50%;
  animation: ship-camo-sweep 900ms cubic-bezier(0.2, 0.7, 0.4, 1) forwards;
  pointer-events: none;
  filter: blur(10px) brightness(3.2) saturate(1.6);
  mix-blend-mode: screen;
}

/* Remove any glow/camo overlays during the fade-in reveal */
.ship-emoji.fade-in::before,
.enemy-emoji.fade-in::before,
.ship-emoji-inner.fade-in::before {
  display: none !important;
  width: 0 !important;
  height: 0 !important;
  opacity: 0 !important;
  content: none !important;
  animation: none !important;
  pointer-events: none !important;
}

/* Persistent engine glow / trail anchored to the ship container so it's
     not dimmed by inner-element opacity animations. Always brighter than
     the rest of the emoji. */
.enemy-emoji::after {
  content: "";
  position: absolute;
  left: -12%;
  bottom: -8%;
  width: 36%;
  height: 36%;
  border-radius: 50%;
  background: radial-gradient(
    circle at 30% 30%,
    rgba(255, 255, 200, 0.95),
    rgba(255, 255, 200, 0.45) 30%,
    rgba(255, 255, 200, 0.05) 60%,
    rgba(255, 255, 200, 0) 100%
  );
  filter: blur(10px) saturate(180%);
  /* remove the extra horizontal flip here; the wrapper now handles mirroring */
  transform: rotate(-45deg);
  transform-origin: 50% 50%;
  opacity: 0;
  transition: opacity 220ms linear;
  pointer-events: none;
}

/* enemy ship: push glow to extreme bottom-right corner */
.enemy-emoji::after {
  position: absolute;
  z-index: 4;
  /* mirror of player glow: position visually bottom-right and allow it to extend outside the emoji */
  left: -12%;
  bottom: -8%;
  width: 46%;
  height: 30%;
  border-radius: 50% / 40%;
  opacity: 0;
  background: radial-gradient(
    ellipse at 75% 70%,
    rgba(255, 255, 180, 1) 0%,
    rgba(255, 245, 120, 0.98) 12%,
    rgba(255, 230, 70, 0.95) 28%,
    rgba(255, 200, 40, 0.6) 55%,
    rgba(255, 170, 10, 0) 80%
  );
  content: "";
  transform: scaleX(-1) rotate(-45deg);
  transform-origin: 50% 50%;
  animation: engine-pulse-subtle 1300ms ease-in-out infinite alternate;
  pointer-events: none;
  filter: blur(6px) brightness(6) saturate(2.4);
  mix-blend-mode: screen;
}

/* Show engine glow when ship fades in */
.ship-emoji.fade-in::after,
.enemy-emoji.fade-in::after {
  opacity: 1 !important;
  transform: rotate(-45deg) scale(1.05) !important;
  animation: engine-pulse-subtle 1300ms ease-in-out infinite alternate !important;
}

/* Hide engine glow during explosion */
.ship-emoji.exploding::after,
.enemy-emoji.exploding::after {
  opacity: 0 !important;
  transform: scale(0.9) !important;
  animation: none !important;
}

/* more subtle, smoother pulse for engine glow */
@keyframes engine-pulse-subtle {
  0% {
    opacity: 0.9;
    transform: translateX(-50%) scaleY(1);
    filter: blur(9px) brightness(2.8) saturate(1.5);
  }
  100% {
    opacity: 1;
    transform: translateX(-50%) scaleY(1.06);
    filter: blur(11px) brightness(3.6) saturate(1.8);
  }
}

/* Bloom layer: very soft, low-opacity blur to simulate bloom without overpowering */
.ship-emoji::before,
.enemy-emoji::before {
  position: absolute;
  z-index: 2;
  bottom: -14%;
  left: 50%;
  width: 100%;
  height: 60%;
  opacity: 0.12; /* make bloom even dimmer */
  background: radial-gradient(
    circle at 50% 10%,
    rgba(255, 240, 200, 0.9) 0%,
    rgba(255, 200, 120, 0.5) 25%,
    rgba(255, 120, 60, 0.15) 50%,
    rgba(0, 0, 0, 0) 80%
  );
  content: "";
  transition: opacity 400ms ease;
  transform: translateX(-50%);
  pointer-events: none;
  filter: blur(20px) brightness(2.2) saturate(1.2);
  mix-blend-mode: screen;
}

/* Mirror bloom position slightly for enemy so it reads as cornered */
.enemy-emoji::before {
  right: 25%;
  left: auto;
  transform: translateX(50%);
}

.ship-emoji-inner.fade-in::before {
  top: 15%;
  bottom: 10%;
  /* center the orange camo/glow overlay during the fade-in reveal */
  left: 25%;
  width: 120%;
  height: 120%;
  border-radius: 50%;
  transform: translate(-50%, -50%) rotate(0deg);
  transform-origin: 50% 50%;
  animation: ship-camo-sweep 900ms cubic-bezier(0.2, 0.7, 0.4, 1) forwards;
}

@keyframes ship-camo-sweep {
  0% {
    opacity: 1;
    transform: scale(0);
    filter: blur(14px);
  }
  20% {
    opacity: 1;
    transform: scale(0.9);
    filter: blur(12px);
  }
  40% {
    z-index: 2; /* keep overlay above the emoji */
    opacity: 0.9;
    transform: scale(1.25);
    filter: blur(10px);
  }
  60% {
    opacity: 0.6;
    transform: scale(1.7);
    filter: blur(9px);
  }
  85% {
    opacity: 0.25;
    transform: scale(2.2);
    filter: blur(8px);
  }
  100% {
    opacity: 0;
    transform: scale(2.8);
    filter: blur(8px);
  }
}

@keyframes ship-flicker {
  0% {
    filter: brightness(0.6) saturate(0.2);
  }
  50% {
    filter: brightness(1.6) saturate(1.2);
  }
  100% {
    filter: brightness(1) saturate(1);
  }
}

@keyframes ship-fade-in {
  0% {
    opacity: 0;
    transform: scale(0.98) rotate(-0.8deg) skewX(3deg);
    filter: blur(18px) contrast(0.75) saturate(0.6) hue-rotate(-8deg);
    -webkit-mask-position: center center;
    mask-position: center center;
    -webkit-mask-size: 0% 0%;
    mask-size: 0% 0%;
  }
  25% {
    opacity: 0.88;
    transform: scale(1.01) rotate(0.4deg) skewX(1deg);
    filter: blur(12px) contrast(0.9) saturate(0.85);
    -webkit-mask-position: center center;
    mask-position: center center;
    -webkit-mask-size: 60% 60%;
    mask-size: 60% 60%;
  }
  55% {
    opacity: 0.97;
    transform: scale(1.002) rotate(-0.2deg) skewX(0deg);
    filter: blur(6px) contrast(1.02) saturate(1.02);
    -webkit-mask-position: center center;
    mask-position: center center;
    -webkit-mask-size: 120% 120%;
    mask-size: 120% 120%;
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0) skewX(0);
    filter: blur(0) contrast(1) saturate(1) hue-rotate(0);
    -webkit-mask-position: center center;
    mask-position: center center;
    -webkit-mask-size: 200% 200%;
    mask-size: 200% 200%;
  }
}

.game-message {
  display: flex;
  overflow-y: auto;
  align-items: flex-start;
  justify-content: center;
  width: 100%;
  max-width: 900px;
  height: 170px;
  box-sizing: border-box;
  padding: 1.5rem;
  margin: 2em auto 0;
  border: 2px solid #00ff00;
  border-radius: 0px;
  scrollbar-width: none;
}

/* Override: hide engine glow completely for both player and enemy
   Keeps pseudo-elements present but visually disabled; uses !important
   so this rule wins over any debug/show rules. */
.ship-emoji::after,
.enemy-emoji::after {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
  animation: none !important;
  pointer-events: none !important;
}
